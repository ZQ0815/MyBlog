# 常用数据结构

##  字符串
>String类型是二进制安全的。意思是redis的string可以包含任何数据，比如jpg图片或者序列化的对象。
**String的定义**
```
struct sdshdr {
 long len;
 long free;
 char buf[];
};
```

## hashes类型操作
Redis hash 是一个 string 类型的 field 和 value 的映射表.它的添加、删除操作都是 O(1)（平均）。
hash 特别适合用于存储对象。相较于将对象的每个字段存成单个 string 类型。将一个对象存
储在 hash 类型中会占用更少的内存，并且可以更方便的存取整个对象。省内存的原因是新
建一个 hash 对象时开始是用 zipmap（又称为 small hash）来存储的。这个 zipmap 其实并不
是 hash table，但是 zipmap 相比正常的 hash 实现可以节省不少 hash 本身需要的一些元数据
存储开销。尽管 zipmap 的添加，删除，查找都是 O(n)，但是由于一般对象的 field 数量都不
太多。所以使用 zipmap 也是很快的,也就是说添加删除平均还是 O(1)。如果 field 或者 value
的大小超出一定限制后，Redis 会在内部自动将 zipmap 替换成正常的 hash 实现. 这个限制可
以在配置文件中指定

### 应用场景
1. 存用户信息

## lists类型及操作
list 是一个链表结构，主要功能是 push、pop、获取一个范围的所有值等等，操作中 key 理
解为链表的名字。
Redis 的 list 类型其实就是一个每个子元素都是 string 类型的双向链表。链表的最大长度是(2
的 32 次方)。我们可以通过 push,pop 操作从链表的头部或者尾部添加删除元素。这使得 list
既可以用作栈，也可以用作队列。
有意思的是 list 的 pop 操作还有阻塞版本的，当我们[lr]pop 一个 list 对象时，如果 list 是空，
或者不存在，会立即返回 nil。但是阻塞版本的 b[lr]pop 则可以阻塞，当然可以加超时时
间，超时后也会返回 nil。为什么要阻塞版本的 pop 呢，主要是为了避免轮询。举个简单的
例子如果我们用 list 来实现一个工作队列。执行任务的 thread 可以调用阻塞版本的 pop 去获
取任务这样就可以避免轮询去检查是否有任务存在。当任务来时候工作线程可以立即返回，
也可以避免轮询带来的延迟。

### 应用场景
1. 存信息集合，将好友的动态全部存到list集合中。

## sets类型及操作
set 是集合，和我们数学中的集合概念相似，对集合的操作有添加删除元素，有对多个集合
求交并差等操作，操作中 key 理解为集合的名字。
Redis 的 set 是 string 类型的无序集合。set 元素最大可以包含(2 的 32 次方)个元素。
set 的是通过 hash table 实现的，所以添加、删除和查找的复杂度都是 O(1)。hash table 会随
着添加或者删除自动的调整大小。需要注意的是调整 hash table 大小时候需要同步（获取写
锁）会阻塞其他读写操作，可能不久后就会改用跳表（skip list）来实现，跳表已经在 sorted 
set 中使用了。关于 set 集合类型除了基本的添加删除操作，其他有用的操作还包含集合的
取并集(union)，交集(intersection)，差集(difference)。通过这些操作可以很容易的实现 sns
中的好友推荐和 blog 的 tag 功能。

### 应用场景
1. 关系模型，有哪些共同好友等。
2. 用来存热搜信息。